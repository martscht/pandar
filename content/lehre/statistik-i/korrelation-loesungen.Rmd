---
title: Korrelation - Lösungen
type: post
date: '2021-01-04'
slug: korrelation-loesungen
categories: Statistik I Übungen
tags: []
subtitle: ''
summary: ''
authors:
- nehler
- winkler
- vogler
- schroeder
weight: ~
lastmod: '`r Sys.Date()`'
featured: no
banner:
  image: /header/storch_with_baby.jpg
  caption: '[Courtesy of pxhere](https://pxhere.com/de/photo/855019)'
projects: []
expiryDate: ''
publishDate: ''
_build:
  list: never
reading_time: no
share: no
links:
- icon_pack: fas
  icon: book
  name: Inhalte
  url: /lehre/statistik-i/korrelation
- icon_pack: fas
  icon: pen-to-square
  name: Übungen
  url: /lehre/statistik-i/korrelation-uebungen
output:
  html_document:
    keep_md: yes
private: 'true'
---

```{r setup, cache = FALSE, include = FALSE, purl = FALSE}
if (exists("figure_path")) {
  knitr::opts_chunk$set(fig.path = figure_path)
}
# Aktuell sollen die global options für die Kompilierung auf den default Einstellungen gelassen werden
library(knitr)
```

## Vorbereitung

```{r, echo = F}
#### Was bisher geschah: ----

# Daten laden
load(url('https://pandar.netlify.app/daten/fb25.rda'))

# Nominalskalierte Variablen in Faktoren verwandeln
fb25$hand_factor <- factor(fb25$hand,
                             levels = 1:2,
                             labels = c("links", "rechts"))
fb25$fach <- factor(fb25$fach,
                    levels = 1:5,
                    labels = c('Allgemeine', 'Biologische', 'Entwicklung', 'Klinische', 'Diag./Meth.'))
fb25$ziel <- factor(fb25$ziel,
                        levels = 1:4,
                        labels = c("Wirtschaft", "Therapie", "Forschung", "Andere"))
fb25$wohnen <- factor(fb25$wohnen, 
                      levels = 1:4, 
                      labels = c("WG", "bei Eltern", "alleine", "sonstiges"))
fb25$fach_klin <- factor(as.numeric(fb25$fach == "Klinische"),
                         levels = 0:1,
                         labels = c("nicht klinisch", "klinisch"))
fb25$ort <- factor(fb25$ort, levels=c(1,2), labels=c("FFM", "anderer"))
fb25$job <- factor(fb25$job, levels=c(1,2), labels=c("nein", "ja"))
fb25$unipartys <- factor(fb25$uni3,
                             levels = 0:1,
                             labels = c("nein", "ja"))

# Rekodierung invertierter Items
fb25$mdbf4_r <- -1 * (fb25$mdbf4 - 4 - 1)
fb25$mdbf11_r <- -1 * (fb25$mdbf11 - 4 - 1)
fb25$mdbf3_r <-  -1 * (fb25$mdbf3 - 4 - 1)
fb25$mdbf9_r <-  -1 * (fb25$mdbf9 - 4 - 1)
fb25$mdbf5_r <- -1 * (fb25$mdbf5 - 4 - 1)
fb25$mdbf7_r <- -1 * (fb25$mdbf7 - 4 - 1)

# Berechnung von Skalenwerten
fb25$wm_pre  <- fb25[, c('mdbf1', 'mdbf5_r', 
                        'mdbf7_r', 'mdbf10')] |> rowMeans()
fb25$gs_pre  <- fb25[, c('mdbf1', 'mdbf4_r', 
                        'mdbf8', 'mdbf11_r')] |> rowMeans()
fb25$ru_pre <-  fb25[, c("mdbf3_r", "mdbf6", 
                         "mdbf9_r", "mdbf12")] |> rowMeans()

# z-Standardisierung
fb25$ru_pre_zstd <- scale(fb25$ru_pre, center = TRUE, scale = TRUE)

```

> Laden Sie zunächst den Datensatz `fb25` von der pandar-Website. Alternativ können Sie die fertige R-Daten-Datei [<i class="fas fa-download"></i> hier herunterladen](/daten/fb25.rda). Beachten Sie in jedem Fall, dass die [Ergänzungen im Datensatz](/lehre/statistik-i/korrelation/#prep) vorausgesetzt werden. Die Bedeutung der einzelnen Variablen und ihre Antwortkategorien können Sie dem Dokument [Variablenübersicht](/lehre/statistik-i/variablen.pdf) entnehmen.

Prüfen Sie zur Sicherheit, ob alles funktioniert hat: 

```{r}
dim(fb25)
names(fb25)
```

Der Datensatz besteht aus `r nrow(fb25)` Zeilen (Beobachtungen) und `r ncol(fb25)` Spalten (Variablen). Falls Sie bereits eigene Variablen erstellt haben, kann die Spaltenzahl natürlich abweichen.


***

## Aufgabe 1

Das Paket `psych` enthält vielerlei Funktionen, die für die Analyse von Datensätzen aus psychologischer Forschung praktisch sind. Eine von ihnen (`describe()`) erlaubt es, gleichzeitig verschiedene Deskriptivstatistiken für Variablen zu erstellen.

  * Installieren (falls noch nicht geschehen) und laden Sie das Paket `psych`.
  * Nutzen Sie den neugewonnen Befehl `describe()`, um sich gleichzeitig die verschiedenen Deskriptivstatistiken für Lebenszufriedenheit (`lz`) ausgeben zu lassen.

<details>

<summary>Lösung</summary>

```{r, eval = FALSE}
# Paket installieren
install.packages('psych')
```

```{r message=FALSE}
# Paket laden
library(psych)
```

</details>

-   Nutzen Sie den neugewonnen Befehl `describe()`, um sich gleichzeitig die verschiedenen Deskriptivstatistiken für Lebenszufriedenheit (`lz`) ausgeben zu lassen.

<details>

<summary>Lösung</summary>

```{r}
describe(fb25$lz)
```

</details>

  * Die Funktion `describeBy()` ermöglicht außerdem Deskriptivstatistiken in Abhängigkeit einer gruppierenden Variable auszugeben. Machen Sie sich diesen Befehl zunutze, um sich die Lebenszufriedenheit (`lz`) abhängig von der derzeitigen Wohnsituation (`wohnen`) anzeigen zu lassen.

<details>

<summary>Lösung</summary>

```{r}
describeBy(fb25$lz, group = fb25$wohnen)
```

</details>

-   `describe()` kann auch genutzt werden, um gleichzeitig Deskriptivstatistiken für verschiedene Variablen zu berechnen. Nutzen Sie diese Funktionalität, um sich gleichzeitg die univariaten Deskriptivstatistiken für die fünf Persönlichkeitsdimensionen ausgeben zu lassen.

<details>

<summary>Lösung</summary>

```{r}
describe(fb25[,c("extra","vertr","gewis","neuro","offen")])
```

</details>



## Aufgabe 2

In der Befragung am Anfang des Semesters wurde gefragt, ob Sie neben der Uni einen Nebenjob (`job`) ausüben und mit welcher Hand sie primär schreiben (`hand`). Erstellen Sie für diese beiden Variablen eine Kreuztabelle mit Randsummen.

  * Stellen Sie zunächst sicher, dass die Variablen als Faktoren vorliegen und die Kategorien beider Variablen korrekt bezeichnet sind. 
  
<details>

<summary>Lösung</summary>

Zunächst können wir überprüfen, ob die Variablen als Faktor vorliegen.

```{r}
#Labels
is.factor(fb25$job)
is.factor(fb25$hand)
```

Wenn Sie die Datensatzvorbereitung aus dem Skript kopiert haben, sollte die Variable `job` bereits ein Faktor sein.
Die Variable `hand` jedoch nicht. Dies müssen wir ändern.

```{r}
fb25$hand <- factor(fb25$hand,
                    levels = c(1, 2),
                    labels = c("links", "rechts"))
```

Für den Fall, dass die Variable `job` noch nicht als Faktor im Datensatz vorliegt, kann folgender Code durchgeführt werden. Achten Sie aber drauf, dass dieser Befehl auf eine Variable nicht angewendet werden sollte, wenn diese bereits ein Faktor ist. Ansonsten kommt es zu dem Fehler, dass die Variable keine Informationen mehr enthält.

```{r, eval = F}
fb25$job <- factor(fb25$job, levels = c(1, 2),
  labels = c('nein', 'ja'))
```

Die Variablen sehen dann folgendermaßen aus.

```{r}
str(fb25$job)

str(fb25$hand)
```

</details>

-   Wie viele Personen sind Linkshänder und haben keinen Nebenjob?

<details>

<summary>Lösung</summary>

```{r}
# Kreuztabelle absolut
tab <- table(fb25$hand, fb25$job)
addmargins(tab)
```

`r tab[1,1]` Personen schreiben primär mit der linken Hand und haben keinen Nebenjob.

</details>

-   Was ist der relative Anteil aller Teilnehmenden, die einem Nebenjob nachgehen?

<details>

<summary>Lösung</summary>

```{r}
# Relative Häufigkeiten, mit Randsummen
addmargins(prop.table(tab))
```

`r round(addmargins(prop.table(tab))[3,2]*100,2)`% aller Teilnehmenden gehen einer Nebentätigkeit nach.

</details>

-   Berechnen Sie nun mit Hilfe des `psych`-Pakets die Korrelationskoeffizienten Phi ($\phi$) und Yules Q für das oben genannte Beispiel.

<details>

<summary>Lösung</summary>

```{r}
phi(tab, digits = 3)

Yule(tab) |> round(digits = 3) #da die Yule()-Funktion nicht direkt runden kann geben wir das Ergebnis an die round()-Funktion weiter
```

Beide Koeffizienten sprechen für eine mittelstarke Korrelation. Das $\phi$ geringer ausfällt kann an der Empfindlichkeit gegenüber ungleichen Randverteilungen liegen.

</details>


## Aufgabe 3

Welche der fünf Persönlichkeitsdimensionen Extraversion (`extra`), Verträglichkeit (`vertr`), Gewissenhaftigkeit (`gewis`), Neurotizismus (`neuro`) und Offenheit für neue Erfahrungen (`offen`) ist am stärksten mit der Lebenszufriedenheit korreliert (`lz`)?

  * Überprüfen Sie die Voraussetzungen für die Pearson-Korrelation.


<details>

<summary>Lösung</summary>

**Voraussetzungen Pearson-Korrelation:**

1.  Skalenniveau: intervallskalierte Daten $\rightarrow$ ok\
2.  Linearität: Zusammenhang muss linear sein $\rightarrow$ Grafische überprüfung (Scatterplot)

```{r}
# Scatterplot
plot(fb25$extra, fb25$lz, 
  xlim = c(0, 6), ylim = c(0, 7), pch = 19)

plot(fb25$vertr, fb25$lz, 
  xlim = c(0, 6), ylim = c(0, 7), pch = 19)

plot(fb25$gewis, fb25$lz, 
  xlim = c(0, 6), ylim = c(0, 7), pch = 19)

plot(fb25$neuro, fb25$lz, 
  xlim = c(0, 6), ylim = c(0, 7), pch = 19)

plot(fb25$offen, fb25$lz, 
  xlim = c(0, 6), ylim = c(0, 7), pch = 19)
```

Die fünf Scatterplots lassen allesamt auf einen linearen Zusammenhang zwischen den Variablen schließen.

3.  Normalverteilung $\rightarrow$ QQ-Plot, Histogramm oder Shapiro-Wilk-Test

```{r}
#QQ
qqnorm(fb25$extra)
qqline(fb25$extra)

qqnorm(fb25$vertr)
qqline(fb25$vertr)

qqnorm(fb25$gewis)
qqline(fb25$gewis)

qqnorm(fb25$neuro)
qqline(fb25$neuro)

qqnorm(fb25$offen)
qqline(fb25$offen)

qqnorm(fb25$lz)
qqline(fb25$lz)

#Histogramm
hist(fb25$extra, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$extra, na.rm = TRUE), sd = sd(fb25$extra, na.rm = TRUE)), col = "#00618F", add = TRUE)  

hist(fb25$vertr, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$vertr, na.rm = TRUE), sd = sd(fb25$vertr, na.rm = TRUE)), col = "#00618F", add = TRUE)  

hist(fb25$gewis, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$gewis, na.rm = TRUE), sd = sd(fb25$gewis, na.rm = TRUE)), col = "#00618F", add = TRUE)  

hist(fb25$neuro, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$neuro, na.rm = TRUE), sd = sd(fb25$neuro, na.rm = TRUE)), col = "#00618F", add = TRUE)  

hist(fb25$offen, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$offen, na.rm = TRUE), sd = sd(fb25$offen, na.rm = TRUE)), col = "#00618F", add = TRUE)  

hist(fb25$lz, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$lz, na.rm = TRUE), sd = sd(fb25$lz, na.rm = TRUE)), col = "#00618F", add = TRUE)  

#Shapiro
shapiro.test(fb25$extra)
shapiro.test(fb25$vertr)
shapiro.test(fb25$gewis)
shapiro.test(fb25$neuro)
shapiro.test(fb25$offen)
shapiro.test(fb25$lz)


```

$p < \alpha$ $\rightarrow$ H1: Normalverteilung kann für alle Variablen nicht angenommen werden. Somit ist diese Voraussetzung für alle Variablen verletzt. Daher sollten wir fortlaufend die Rangkorrelation nach Spearman nutzen.

</details>

-   Erstellen Sie für diese Frage eine Korrelationsmatrix, die alle Korrelationen enthält. Verwenden Sie die Funktion `round()` (unter Betrachtung der Hilfe), um die Werte auf zwei Nachkommastellen zu runden und die Tabelle dadurch übersichtlicher darzustellen.

<details>
<summary>Lösung</summary>

```{r}
# Korrelationstabelle erstellen und runden
cor_mat <- round(cor(fb25[,c('lz', 'extra', 'vertr', 'gewis', 'neuro', 'offen')],
                     use = 'pairwise',
                     method = 'spearman'),3)
cor_mat
```


</details>

-   Wie würden Sie das Ausmaß der betragsmäßig größten Korrelation mit der Lebenszufriedenheit nach den Richtlinien von Cohen (1988) einschätzen?

<details>

<summary>Lösung</summary>

Die betragsmäßig größte Korrelation mit der Lebenszufriedenheit hat die Extraversion. Nach den Richtlinien ist dieser mit `r cor_mat[2]` einem mittleren Effekt, der ungefähr 0.3 beträgt, zuzuordnen.

</details>

-   Ist der Korrelationskoeffizient von Lebenszufriedenheit und Extraversion statistisch signifikant?

<details>

<summary>Lösung</summary>

```{r}
cor.test(fb25$lz, fb25$extra, 
         alternative = "two.sided", 
         method = "spearman",       
         use = "pairwise") 
```

$p < \alpha$ $\rightarrow$ H1. Die Korrelation ist mit einer Irrtumswahrscheinlichkeit von 5% signifikant von 0 verschieden.

</details>

## Aufgabe 4

Untersuchen Sie die Korrelation zwischen Gewissenhaftigkeit (`gewis`) und Prokrastinationstendenz (`prok`). Berechnen Sie dafür ein geeignetes Korrelationsmaß und testen Sie dieses auf Signifikanz.

<details>

<summary>Lösung</summary>

Um das geeignete Korrelationsmaß zu bestimmen überprüfen wir zunächst die Vorrausetzungen der Pearson-Korrelation:

1.  Skalenniveau: intervallskalierte Daten $\rightarrow$ ok\
2.  Linearität: Zusammenhang muss linear sein $\rightarrow$ Grafische überprüfung (Scatterplot)

```{r}
# Scatterplot
plot(fb25$gewis, fb25$prok, 
  xlim = c(0, 6), ylim = c(0, 7), pch = 19)
```

Es ist ein linearer Zusammenhang zwischen `gewis` und `prok` zu erkennen.

3.  Normalverteilung $\rightarrow$ QQ-Plot, Histogramm oder Shapiro-Wilk Test

```{r message=FALSE}
#Car-Paket laden
library(car)
```

```{r}

#QQ-Plot
qqPlot(fb25$gewis)
qqPlot(fb25$prok)


#Histogramm
hist(fb25$gewis, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$gewis, na.rm = TRUE), sd = sd(fb25$gewis, na.rm = TRUE)), col = "#00618F", add = TRUE)  

hist(fb25$prok, prob = TRUE, ylim = c(0, 1))
curve(dnorm(x, mean = mean(fb25$prok, na.rm = TRUE), sd = sd(fb25$prok, na.rm = TRUE)), col = "#00618F", add = TRUE)


#Shapiro-Wilk Test
shapiro.test(fb25$gewis) #signifikant
shapiro.test(fb25$prok) #signifikant

```

Auf Basis der zwei graphischen und dem inferenzstatistischen Verfahren kommen wir zum Schluss das beide Variablen nicht normalverteilt vorliegen.

Somit kommen wir zum Schluss das die Spearman-Rangkorrelation hier das richtige Korrelationsmaß ist.


```{r}
cor.test(fb25$gewis, fb25$prok,
                        alternative = "two.sided",
                        method = "spearman",
                        use = "pairwise")
```

```{r echo=FALSE}
cor_pearson <- cor.test(fb25$gewis, fb25$prok,
                        alternative = "two.sided",
                        method = "pearson",
                        use = "pairwise")

cor_spearman <- cor.test(fb25$gewis, fb25$prok,
                        alternative = "two.sided",
                        method = "spearman",
                        use = "pairwise")

```

Die Spearman-Rangkorrelation (p = `r cor_spearman$p.value`) ist nicht signifikant von 0 verschieden. 

</details>

## Aufgabe 5 Bonus

Im vorherigen Kapitel haben wir die Poweranalyse behandelt. Solche Analysen kann man auch für Korrelationen vornehmen. Frischen Sie gerne Ihren Wissensstand [hier](/lehre/statistik-i/simulation-poweranalyse/) noch einmal auf.
Daher, führen sie mit Hilfe des Pakets `WebPower` eine Sensitivitätsanalyse für den Datensatz `fb25` unter folgenden Parametern durch:

  * Fehler 1. Art ($\alpha = 5\%$)
  * Fehler 2. Art ($\beta = 20\%$)
  * Alternativhypothese ($H_1$: $\rho_1 \neq 0$)
  
<details>

<summary>Lösung</summary>

Bei einer Sensitivitätsanalyse interessiert uns wie stark ein Effekt sein muss damit wir ihn gegeben der Stichprobengröße (n) und $\alpha$-Fehlerniveau mit einer Wahrscheinlichkeit (Power = 1 - $\beta$) finden.
Einfach gesagt, gesucht ist die aufdeckbare Effektstärke.
Außerdem sind Korrelationen ihre eigenen Effektgrößen, daher müssen wir nicht noch etwa Cohens d berechnen.

```{r message=FALSE}
library(WebPower)
```

```{r}

wp.correlation(n = nrow(fb25),            
               r = NULL,                  #gesucht
               power = 0.8,               #Power = 1 - Beta
               alternative = "two.sided") #leitet sich aus der H1 ab
```

```{r echo=FALSE}
pa <- wp.correlation(n = nrow(fb25),            
                     r = NULL,                  
                     power = 0.8,               
                     alternative = "two.sided")
```

Gegeben es gibt eine von null verschiedene (signifikante) Pearson-Korrelation muss diese mindestens `r round(pa$r, 3)` groß sein, damit wir diese mit einer Power von 80%, auf einem $\alpha$-Fehlerniveau von 5% in unserem Datensatz, mit n = `r nrow(fb25)` finden könnten.

</details>


***
