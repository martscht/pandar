---
title: "Zweifaktorielle ANOVA"
type: post
date: '2021-03-30' 
slug: anova-ii
categories: ["Statistik II"] 
tags: ["ANOVA","Zweifaktoriell", "Kontraste"] 
subtitle: '2-fakt. ANOVA'
summary: ''
authors: [nehler, irmer,scheppa-lahyani,schultze]
weight: 9
lastmod: '`r Sys.Date()`'
featured: no
banner:
  image: "/header/heart_alien.jpg"
  caption: "[Courtesy of pxhere](https://pxhere.com/en/photo/1293359)"
projects: []
reading_time: false
share: false

links:
  - icon_pack: fas
    icon: book
    name: Inhalte
    url: /lehre/statistik-ii/anova-ii
  - icon_pack: fas
    icon: terminal
    name: Code
    url: /lehre/statistik-ii/anova-ii.R
  - icon_pack: fas
    icon: pen-to-square
    name: Übungen
    url: /lehre/statistik-ii/anova-ii-uebungen
output:
  html_document:
    keep_md: true
---

```{r setup, include=FALSE, purl=FALSE}
if (exists("figure_path")) {
  knitr::opts_chunk$set(fig.path = figure_path)
}
# Aktuell sollen die global options für die Kompilierung auf den default Einstellungen gelassen werden
```

In der letzten Sitzung haben wir die [einfaktorielle Varianzanalyse](/lehre/statistik-ii/anova-i) behandelt. Die spezifische Benennung als *einfaktoriell* verdeutlicht schon, dass wir hier ansetzen und Erweiterungen durch die Aufnahme von mehr Faktoren vornehmen können. In dieser Sitzung geht es vor allem um die *zweifaktorielle* Varianzanalyse - also das Vorliegen von zwei Faktoren. Ziel dieser Analyse ist es gleichzeitig Gruppenunterschiede auf zwei Variablen zu untersuchen und dabei zu überprüfen, ob Kombinationen von Gruppen besondere Auswirkungen haben. Für weitere Inhalte siehe bspw. auch [Eid, Gollwitzer und Schmitt (2017, Kapitel 13 und insb. 13.2 und folgend)](https://hds.hebis.de/ubffm/Record/HEB366849158).

Wir arbeiten wieder mit dem `conspiracy` Datensatz. Dieser stammt aus einer Erhebung zur Validierung eines Fragebogens, aus dem Skalenwerte gebildet werden, die verschiedene Dimensionen von Verschwörungsglauben abbilden sollen. 


### Daten laden

Da die Rohdaten hier einige Informationen erhalten, die wir für die Durchführung des Tutorials nicht benötigen, stellen wir ein Aufbereitungsskript bereit, dass direkt eine Version des Datensatzes lädt, die für die Durchführung des Tutorials geeignet ist. Dieses kann mit dem `source()`-Befehl geladen und ausgeführt werden. 


```{r, eval = T}
source("https://pandar.netlify.app/daten/Data_Processing_conspiracy.R")
```

Eine kurze Übersicht über den Datensatz zeigt:

```{r}
dim(conspiracy)
```

Der Datensatz enthält die Werte von `r dim(conspiracy)[1]` Personen auf `r dim(conspiracy)[2]` Variablen. 

```{r}
head(conspiracy)
```

Er stammt aus einer Untersuchung zum Thema *verschwörungstheoretische Überzegungen*. Die **ersten vier Variablen** enthalten Informationen über den demographischen Hintergrund der Personen: höchster Bildungsabschluss (`edu`), Typ des Wohnortes (`urban`), Geschlecht (`gender`) und Alter (`age`). Die **fünf restlichen Variablen** sind Skalenwerte bezüglich verschiedener subdimensionen verschwörungstheoretischer Überzeugungen: `GM` (goverment malfeasance), `GC` (malevolent global conspiracies), `EC` (extraterrestrial cover-up), `PW` (personal well-being) und `CI` (control of information).

Den Datensatz haben wir in der letzten Sitzung schon genutzt, haben dabei aber nicht genauer die Struktur angeschaut. Dies holen wir hier einmal nach.

```{r}
str(conspiracy)
```

Der Output zeigt, dass wir Variablen vom Typen `factor` und `numeric` (und `integer`) haben. Besonderen Fokus wollen wir auf die Variablen `urban`, `edu` und `ET` liegen, da diese in diesem Tutorial behandelt werden. `EC` liegt schon als `numeric` vor, was an dieser Stelle für einen Fragebogenscore auch Sinn macht. Die anderen beiden Variablen sind vom Typen `factor`, was hier Sinn ergibt, da nur bestimmte Ausprägungen hier auftreten können (kein Freitext sondern nominale Kategorien).

## Einfaktorielle ANOVA

In der letzten Sitzung zeigte sich, dass die Überzeugung, dass die Existenz von Außerirdischen durch eine globale Verschwörung verdeckt wird (`EC`), von der Art des Wohngebiets (`urban`) abhängig ist. Zur Berechnung der einfaktoriellen ANOVA wurde das `afex`-Paket verwendet. Dieses Paket brauchen wir weiterhin:

```{r, message = F}
library(afex)
```

Wir führen zur kurzen Wiederholung noch einmal die einfaktorielle ANOVA bezüglich des Bildungsniveaus (`edu`) durch, um uns zu vergegenwärtigen, wie der `aov_4()`-Befehl funktioniert! Wie schon in der letzten Sitzung, ist es zunächst erforderlich eine Personen-ID zu erzeugen. In diesem Fall kann einfach die Zeilennummer einer Person genutzt werden:

```{r}
conspiracy$id <- as.factor(1:nrow(conspiracy))
```

Das erste Argument der `aov_4()`-Funktion ist im Stil der Regressionsformel - wir müssen zunächst die abhängige Variable nennen (`EC`), dann die unabhängige Variable (`edu`) nach der Tilde `~` und zum Abschluss müssen wir noch `(1|id)` ergänzen. Die Bedeutung dieses zusätzlichen Terms werden wir im nächsten Tutorial beleuchten. Als zweites Argument muss der Datensatz angegeben werden (`data = conspiracy`). 

```{r}
aov_4(EC ~ edu + (1|id), data = conspiracy)
```

Die Ergebnisse zeigen, dass es signifikante Unterschiede zwischen den verschiedenen Wohnorten gibt. Zusätzlich erhalten wir auch das generalisierte partielle $\eta^2$, also einen Schätzer der Effektstärke, die im Grunde angibt, wie viel systematische Variation in den Daten ist, relativ zur zufälligen Schwankung. Um dies in der Skala der ursprünglichen Variablen zu interpretieren, können wir uns rein deskriptiv die gruppenspezifischen Mittelwerte angucken. Dazu kann mit einer Vielzahl von Funktionen gearbeitet werden. Eine gängige Variante ist der `aggregate()`-Befehl, den wir auch bereits kennengelernt haben.

```{r}
aggregate(EC ~ edu, conspiracy, mean)
```

Es gibt jedoch noch unzählbar viele andere Wege zum selben Ergebnis zu kommen. Hier einige Beispiele:

```{r}
# Mithilfe des tapply-Befehls
tapply(X = conspiracy$EC, INDEX = conspiracy$edu, FUN = mean)

# Mithilfe des aggregate-Befehls mit anderer Schreibweise (wie bei tapply)
aggregate(conspiracy$EC, list(conspiracy$edu), mean)

# Mithilfe des describeBy-Befehls aus dem psych-Paket
library(psych)
describeBy(conspiracy$EC, conspiracy$edu)
```

## Deskriptive Darstellung der Kombinationen

In der mehrfaktoriellen ANOVA steht nicht nur der Vergleich von Gruppen anhand *einer* unabhängigen Variable im Mittelpunkt, sondern der Fokus liegt auf der *Kombination von Gruppierungen* anhand mehrerer unabhängiger Variablen. Deskriptiv können die Mittelwerte aus Gruppenkombinationen ebenfalls mit der `aggregate()`-Funktion bestimmt werden:

```{r}
# Kombinationsspezifische Mittelwertetabelle
aggregate(EC ~ urban + edu, conspiracy, mean)
```


Auf den ersten Blick fällt schon einmal auf, dass Menschen, die als höchsten Bildungsabschluss das College besucht hatten, deutlich niedrigere Mittelwerte hinsichtlich der Verschwörung aufweisen, als jene, die keinen High-School oder maximal einen High-School Abschluss haben. Auch wenn die tabellarische Übersicht für manche die präferierte Variante sein wird, ist es auf Postern und in Berichten häufig so, dass stattdessen Grafiken eingesetzt werden. Wir schauen uns hier erstmal an, wie man eine solche Grafik erstellen könnte mit dem `ggplot2` Paket.

```{r}
library(ggplot2)
```

Damit wir die Mittelwerte darstellen können, müssen diese natürlich auch an die Funktion gegeben werden. Dafür nutzen wir den `aggregate()`-Befehl und geben über die Pipe `|>` die resultierende Tabelle als Datensatz an die `ggplot()` Funktion weiter. Als nächstes ist es wichtig zu entscheiden, welcher Faktor wo abgebildet werden sollte. Wir nehmen hier `urban` auf der x-Achse, weshalb wir es in den Ästhetiken (`aes()`) auch `x` zuordnen. Die abhängige Variable wird `y` zugeordnet. Der zweite Faktor wird sowohl `color` als auch `group` zugeordnet, damit die Stufen dieses Faktors die Farbe bestimmen und auch mit Linien verbunden werden. Die passenden Geometrien sind dann `geom_point()` und `geom_line()`. Zur besseren Darstellung können bspw. die Beschriftung der Aspekte (`labs()`) geändert werden, aber wie wir bereits wissen, sind die Möglichkeiten in `ggplot2` hier fast endlos.

```{r}
aggregate(EC ~ urban + edu, conspiracy, mean) |> 
  ggplot(aes(x = urban, y = EC, color = edu, group = edu)) +
    geom_point() +
    geom_line() +
    labs(x = "Urban", y = "Mean EC", color = "Education")
```

Hier werden zunächst wie von uns angefordert nur die Mittelwerte dargestellt. Wer gerne noch Balken (bspw. der geschätzte Standardfehler für den Mittelwert der Gruppen) hinzufügen möchte, kann die Vertiefung anschauen.

<details><summary><b>Mittelwertsplot mit Balken </b></summary>

Es gibt sehr vieel Wege, um in dem Plot Unsicherheit anzuzeigen. Wie bereits geschrieben, wollen wir den geschätzten Standardfehler für den Mittelwert der einzelnen Gruppen ergänzen. Auch dafür gibt es mehrere Wege. Wir stellen an dieser Stelle einen rehct einfachen vor.

Beispielsweise können wir zunächst einen Datensatz erstellen, indem sowohl die Mittelwerte als auch die geschätzten Standarfehler enthalten sind. Für die Schätzung der Standardfehler des Mittelwerts benötigen wir die Stichprobengröße und die geschätzte Populationsstandardabweichung Dafür starten wir mit der Erstellung von getrennten Datensätze.

```{r, purl = FALSE}
# Mittelwert berechnen und in Datensatz ablegen
means_df <- aggregate(EC ~ urban + edu, conspiracy, mean)
# SD berechnen und in Datensatz ablegen
sds_df <- aggregate(EC ~ urban + edu, conspiracy, sd)
# Umbenennen der dritten Spalte in beiden Datensätzen für Klarheit
names(means_df)[3] <- "mean_EC"
names(sds_df)[3] <- "sd_EC"
```

Jetzt können wir die beiden Datensätze mit der `merge()` Funktion zusammenführen. Dabei füllen wir das Argument `by` mit den Namen der beiden Faktoren. Um die Stichprobengröße auch noch einzufügen, starten wir das Spiel nochmal.

```{r, purl = FALSE}
# Zusammenführen
plot_df <- merge(means_df, sds_df, by = c("urban", "edu"))

# Datensatz erstellen und Spalte umbenennen
n_df     <- aggregate(EC ~ urban + edu, conspiracy, length)
names(n_df)[3]     <- "n"

# Zusammenführen
plot_df <- merge(plot_df, n_df, by = c("urban", "edu"))
```

Nun bestimmen wir die geschätzten Standardfehler des Mittelwerts.

```{r, purl = FALSE}
plot_df$se <- plot_df$sd_EC / sqrt(plot_df$n)
```

Anschließend können wir den Plot erstellen. Dabei brauchen wir jetzt das zusätzlich `geom_errobar()`, bei dem wir in den Ästhetiken die obere und untere Grenze der Balken festhalten können.

```{r, purl = FALSE}
ggplot(plot_df, aes(x = urban, y = mean_EC, color = edu, group = edu)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymin = mean_EC - se, ymax = mean_EC + se), width = 0.1) +
  labs(x = "Urban", y = "Mean ET", color = "Education") 
```

</details>

Es wird deutlich, dass sich sowohl für `urban` als auch für `edu` Unterschiede zwischen den jeweiligen Stufen ergeben. Außerdem sehen wir, dass die Linien sich überschneiden - für die Stufe `rural` liegt die mittlere Ausprägung von `EC` bei `not highschool` niedriger als `highschool`, während es bei allen anderen Stufen von `urban` andersrum ist. Ob diese beobachteten Unterschiede aber auch wirklich auf die Population übertragbar sind, schauen uns im Folgenden genauer an, indem wir eine **zweifaktorielle ANOVA** durchführen.

## Zweifaktorielle Varianzanalyse

Mithilfe der zweifaktoriellen Varianzanalyse können drei zentralen Fragen beantwortet werden ([Eid et al., 2017](https://hds.hebis.de/ubffm/Record/HEB366849158), S. 432):

  1. Lassen sich **Unterschiede in der AV** auf **Unterschiede in der 1. UV** zurückführen? (**Haupteffekt 1**, manchmal auch Haupteffekt Faktor A)
  2. Lassen sich **Unterschiede in der AV** auf **Unterschiede in der 2. UV** zurückführen? (**Haupteffekt 2**, manchmal auch Haupteffekt Faktor B)
  3. Hängt der **Einfluss der 1. UV** auf die AV von der **2. UV ab**, bzw. hängt der **Einfluss der 2. UV** von der **1. UV ab**? (**Interaktionseffekt**, manchmal auch Interaktionseffekt A*B)

Im Beispiel wären die Fragen also:

  1. Lassen sich Unterschiede in der EC-Überzeugung (`EC`) auf die Art des Wohnorts (`urban`) zurückführen?
  2. Lassen sich Unterschiede in der EC-Überzeugung (`EC`) auf das Bildungsniveau (`edu`) zurückführen?
  3. Unterschieden sich die Unterschiede aufgrund der Art des Wohnorts (`urban`) zwischen den Bildungsniveaus (`edu`)?

Die Nullhypothesen haben wie gewohnt die Form, dass keine Effekte vorliegen. Die Alternativhypothesen besagen – ähnlich wie in der einfaktoriellen ANOVA –, dass es Effekte gibt, jedoch nicht, welche Gruppen oder Kombinationen dafür konkret verantwortlich sind. Wer sich die technischen Details nochmals ansehen möchte, kann gerne die Vertiefung öffnen.

<details><summary><b>Technische Details zu den Hypothesen </b></summary>

Etwas technischer ausgedrückt lassen sich die drei Fragen in Hypothesenpaaren formulieren ([Eid et al., 2017](https://hds.hebis.de/ubffm/Record/HEB366849158), S. 442):

  1. $H_0: \mu_{j \bullet} - \mu = 0$, $\quad H_1: \mu_{j \bullet} - \mu \neq 0$
  2. $H_0: \mu_{\bullet k} - \mu = 0$, $\quad H_1: \mu_{\bullet k} - \mu \neq 0$
  3. $H_0: \mu_{jk} - \mu_{j \bullet} - \mu_{\bullet k} + \mu = 0$, $\quad H_1: \mu_{jk} - \mu_{j \bullet} - \mu_{\bullet k} + \mu \neq 0$

Diese können von den Gleichungen für die zweifaktorielle ANOVA abgeleitet werden. Der beobachtete Wert der i-ten Person aus Stufe j des 1. Faktors (Faktor A) und Stufe k des 2. Faktors (Faktor B) setzt sich wie folgt zusammen:

$$Y_{ijk} := \mu + \alpha_j+\beta_k + \gamma_{jk} + \varepsilon_{ijk} = \mu_{jk} + \varepsilon_{ijk},$$

wobei $\mu$ der Mittelwert über alle Messungen ist (Grand Mean). $\alpha_j$ stellt die Abweichung vom Mittelwert bedingt durch den Faktor A auf der j-ten Stufe, $\beta_k$ die Abweichung von Mittelwert bedingt durch den Faktor B auf der k-ten Stufe dar. $\gamma_{jk}$ ist die Abweichung vom Mittelwert aufgrund der spezifischen Kombination des Faktors A auf der j-ten Stufe und des Faktors B auf der k-ten, was auch die Interaktionen dieser Gruppenkombination genannt wird. Entsprechend stellt $\mu_{jk}$ auch den Mittelwert in Gruppe Faktor A Stufe j und Faktor B Stufe k dar. $\varepsilon_{ijk}$ beschreibt das Residuum, das zufällige Abweichungen in den Gruppen darstellt (dieses wird als normalverteilt und unabhängig mit gleicher Varianz über alle Gruppen hinweg angenommen!). Nun können wir die Gleichung von oben hierzu übersetzten:

1. $\mu_{j \bullet}$ ist der Mittelwert der j-ten Stufe auf Faktor A unabhängig von Faktor B - hier wird also über alle $\beta_k$ und $\gamma_{jk}$ gemittelt ($\beta_k$ und $\gamma_{jk}$ fallen somit weg). Somit ist $\alpha_j$ nichts anderes als die Differenz zwischen $\mu_{j \bullet}$ und $\mu$, also: $\alpha_j:=\mu_{j \bullet} - \mu$.

2. $\mu_{\bullet k}$ ist dementsprechend der Mittelwert der k-ten Stufe auf Faktor B unabhängig von Faktor A - $\alpha_j$ und $\gamma_{jk}$ fallen somit weg. Es ergibt sich $\beta_k:=\mu_{\bullet k}-\mu$.

3. $\mu_{jk}$ ist der Mittelwert der entsteht, wenn man Faktor A und Faktor B kombiniert. Da aber der alleinige Interaktionseffekt gesucht ist, muss dieser noch um die alleinigen Effekte $\mu_{j \bullet}$ und $\mu_{\bullet k}$ bereinigt werden. Daher ergibt sich $\gamma_{jk}:=\mu_{jk}-\alpha_j-\beta_k-\mu$ und daraus dann $\gamma_{jk}:=\mu_{jk}-(\mu_{j \bullet}-\mu)-(\mu_{\bullet k}-\mu)-\mu$. Wenn man dies nun vereinfacht, entsteht: $\gamma_{jk}:=\mu_{jk}-\mu_{j \bullet}-\mu_{\bullet k}+\mu$.

Da wir wissen wollen, ob sich die Effekte $\alpha_j$, $\beta_k$ und $\gamma_{jk}$ signifikant von Null unterscheiden, werden die Gleichungen in die oben genannten Hypothesen überführt. Bspw. wäre die Hypothese für Faktor A: $H_0: \alpha_1 = \dots \alpha_J = 0$ oder $H_0: \alpha_j=0$, wobei $\alpha_j:=\mu_{j \bullet} - \mu$.
</details>

Deskriptiv lassen sich Hinweise auf die drei Fragestellungen aus der erstellten Zeichnung erkennen: Für den Faktor `urban`, also für die erste Fragestellung, zeigen sich höhere Werte bei der gleichnamige Ausprägung `urban`, während `suburban` und `rural` ähnlich erscheinen. Es könnte ein Haupteffekt vorliegen. Für den Faktor`edu`, die zweite Fragestellung, fällt `college` mit deutlich niedrigeren Werten, während `not highschool` und `highschool`  sich weniger stark unterscheiden, was insgesamt auch auf einen Haupteffekt hindeuten könnte. Auch für die dritte Fragestellung, also den Interaktionseffekt, gibt es Hinweise, dass er vorliegen könnte. Innerhalb der Gruppe mit ländlichem Wohnort (`rural`) haben Personen ohne Highschool Abschluss (`not highschool`) eine niedrigere verschwörungstheoretische Überzeugung Personen mit Highschool Abschluss (`highschool`), wohingegen sie in den beiden anderen Wohnort-Gruppen einen höheren mittleren Wert (`EC`) aufweisen.


Die drei Nullhypothesen werden in der **zweifaktoriellen ANOVA** gleichzeitig geprüft. Die Schreibweise in `aov_4()` ist dabei ähnlich wie in der einfaktoriellen ANOVA, nur dass nun zwei unabhängige Variablen angegeben werden müssen. Die Syntax lautet: `aov_4(dv ~ uv1 + uv2 + uv1 : uv 2 + (1|id), data = datensatz)`. Dabei ist `dv` die abhängige Variable, `uv1` und `uv2` die beiden unabhängigen Variablen und `id` die Personen-ID. Die gemeinsame Notation der beiden unabhängigen Variablen (`uv1 : uv2`) gibt an, dass die Interaktion der beiden Variablen ebenfalls berücksichtigt werden soll. 

```{r}
aov_4(EC ~ urban + edu + urban : edu + (1|id), data = conspiracy)
```

Der Output zeigt uns die Ergebnisse der zweifaktoriellen ANOVA. Im Vergleich zur einfaktoriellen ANOVA erhalten wir mehr Zeilen, in denen jeweils die Variablennamen gelistet sind. Die Änderung entspricht also genau der Änderung, wenn wir in eine einfache Regression mehr Prädiktoren aufnehmen. Die erste Zeile gibt den Haupteffekt des Wohnorts (`urban`) an, die zweite den Haupteffekt des Bildungsniveaus (`edu`) und die dritte die Interaktion zwischen Wohnort und Bildungsniveau (`urban:edu`). In der Spalte der p-Werte sehen wir, dass sowohl der Haupteffekt des Wohnorts (`urban`) als auch der Haupteffekt des Bildungsniveaus (`edu`) statistisch bedeutsam sind. Die Interaktion zwischen Wohnort und Bildungsniveau ist jedoch nicht signifikant. Inhaltlich heißt das, dass sowohl die Art des Wohnorts als auch das Bildungsniveau einen Einfluss auf die verschwörungstheoretische Überzeugung haben. Über die jeweiligen Effekte hinaus, ist die spezifische Kombination aus Wohnort und Bildungsniveau für diese Überzeugung irrelevant.

Der Output besteht allerdings nicht nur aus der Tabelle mit den Ergebnissen, sondern auch aus einer Warnung (bezüglich Kodierung) und natürlich der Überschrift (bezüglich Typen). Diese Aspekte haben wir im letzten Tutorial erstmal übersprungen, wollen uns jetzt aber mit ihnen beschäftigen.

##### Quadratsummen-Typen 

Bei mehrfaktoriellen ANOVAs können die Quadratsummen ($QS_{A}$, $QS_{B}$ und $QS_{A\times B}$) - also die erklärte Varianz, die den Faktoren zugeschrieben wird - auf unterschiedliche Arten berechnet werden. Verbreitet sind dabei drei Typen (bzw. eigentlich eher zwei zentrale Typen), zwischen denen man sich anhand der inhaltlichen Hypothesen entscheiden sollte. Wir besprechen hier im Text nur die Typen II und III - wer sich für eine genauere Betrachtung von Typ I interessiert, kann sich gerne [den Appendix](#AppendixA) anschauen.

Wie die Tabellenüberschrift unseres Outputs sagt, ist der default-Typ in `aov_4()` Typ III. Jeder Effekt wird berechnet, nachdem alle anderen Effekte des Modells (Haupteffekte und Interaktionen) berücksichtigt wurden.

```{r}
aov_4(EC ~ urban + edu + urban : edu + (1|id), data = conspiracy)
```

Typ II berücksichtigt in der Berechnung der Quadratsummen von Effekten im Gegensatz dazu nur alle anderen Haupteffekte. In der Berechnung der  Quadratsummen der Haupteffekte wird damit angenommen, dass alle Interaktionen, an denen dieser Term beteiligt ist, 0 sind. In dem Befehl kann man diese Quadratsummen mit dem Argument `type = "II"` anfordern: 

```{r}
# QS-Typ 2
aov_4(EC ~ urban + edu + urban : edu + (1|id), data = conspiracy, type = "II")
```
Die Unterscheidung zwischen Typ II und Typ III ist also, dass bei Typ II die Interaktionseffekte nicht berücksichtigt werden, wenn die Quadratsumme der Haupteffekte berechnet wird. Bei Typ III hingegen werden alle anderen Haupteffekte und Interaktionen berücksichtigt. In den Zahlen merken wir das daran, dass die empirischen F-Werte, die ja die Quadratsummen der Effekte im Zähler haben, unterschiedlich sind. Spezifischer kann man sagen, dass sie bei Typ II größer sind, da die Quadratsummen der Haupteffekte nicht auf die Interaktionseffekte kontrolliert wurden. Die Quadratsummen der Interaktionseffekte sind bei Typ II und Typ III identisch, da sie in beiden Fällen die Haupteffekte in die Berechnung mit einbeziehen.

Welcher der beiden Typen ist nun der Richtige? Wie in den einleitenden Worten gesagt, sollte die Entscheidung auf den inhaltlichen Hypohtesen basieren. Sind Unterschiede nur für die Haupteffekte zu erwarten und nicht für den Interaktionseffekt, sollte Typ II verwendet werden, denn hier haben wir die höhere Power. Sind hingegen Interaktionseffekte zu erwarten, sollte Typ III verwendet werden. Sollte sich bei der Testung unter Verwendung von Typ II doch ein signifikanter Interaktionseffekt ergeben, sollte die ANOVA nochmal mit Typ III durchgeführt werden - denn dann ist die Annahme für die Verwendung von Typ II ja nicht gegeben (Interaktionseffekt ist doch von 0 verschieden). Sollte sich bei der Testung mit Typ III kein signifikanter Interaktionseffekt ergeben, sollte aber nicht nochmal mit Typ II getestet werden, da dies einer Kumulation von Fehlern gleichkäme.

##### Kodierung der Variablen

Die Message, die wir im Output gesehen haben, bezieht sich auf die Kodierung der kategorialen Variablen mit ungeordneten Ausprägungen und deren Behandlung im Modell. Wie bereits besprochen, werden kategoriale Variablen in Analysen häufig durch sogenannte Kodiervariablen dargestellt, bei denen jeder Gruppe eine Zahl zugeordnet wird. Bei Variablen mit nur zwei Ausprägungen ist dafür lediglich eine Kodiervariable nötig, um die Informationen der ursprünglichen Variable vollständig zu repräsentieren (zum Beispiel erhält eine Gruppe den Wert 0 und die andere den Wert 1). Bei Variablen mit mehr als zwei Ausprägungen (wie in unserem Fall) sind dagegen mehrere Kodiervariablen erforderlich. Die allgemeine Regel lautet: *Anzahl der Ausprägungen - 1*. 

Bei der Bildung der Kodiervariablen haben wir grundsätzlich zwei verschiedene Möglichkeiten. Bei der Einstellung `contr.treatment` (auch als Dummy-Codierung bezeichnet) wird eine der Ausprägungen als Referenzkategorie festgelegt. Die anderen Ausprägungen werden dann in Bezug auf diese Referenzkategorie kodiert. Diese Art der Kodierung ist der Standard in `R` und würde zum Beispiel automatisch angewendet, wenn wir unsere Variablen direkt an eine Regression mit `lm()` übergeben würden.

| Ausprägung        | Variable 1 | Variable 2 |
|-------------------|------------|------------|
| not highschool    | 0          | 0          |
| highschool        | 1          | 0          |
| college           | 0          | 1          |

Bei der Einstellung `contr.sum` (bezeichnet als Effekt-Codierung) werden die Koeffizienten auf den Kodiervariablen so vergeben, dass die Abweichungen vom Mittelwert repräsentiert werden. Wir bilden hier einen ungewichteten Mittelwert der Ausprägungen, indem die Gruppengröße der einzelnen Ausprägungen nicht in dei Effekt-Codierung mit einbezogen werden.

| Ausprägung        | Variable 1 | Variable 2 |
|-------------------|------------|------------|
| not highschool    | -1         | -1         |
| highschool        | 1          | 0          |
| college           | 0          | 1          |

Wie die Mitteilung uns anzeigt, wird in `aov_4()` der Standard `contr.treatment` durch `contr.sum` ersetzt. Das liegt daran, dass `contr.treatment` auf dem Vergleich einer Referenzkategorie mit den anderen Gruppen basiert – was besonders dann sinnvoll ist, wenn es beispielsweise eine Kontrollgruppe und mehrere Treatment-Gruppen gibt (daher auch der Name `contr.treatment`). In der ANOVA liegt der Fokus jedoch nicht auf dem Vergleich zu einer einzelnen Referenzgruppe, sondern auf der Abweichung der Gruppenmittelwerte vom Gesamtmittelwert. Deshalb ist hier die Effektkodierung (`contr.sum`) die richtige Wahl.

##### Abschließende Bemerkungen zur Zweifaktoriellen ANOVA 

Die Interpretation unserer Ergebnisse fällt einfach, da nur die beiden Haupteffekte signifikant sind. Es gibt also Unterschiede hinsichtlich des Wohnorts und des Bildungsniveaus hinsichtlich des Glaubens an Verschwörungstheorien über Extraterrestrische Wesen. Die Interaktion ist nicht signifikant.

Doch gerade das Vorhandensein von Interaktionseffekten kann die Interpretation der Haupteffekte sehr erschweren. Es muss geprüft werden, ob die globalen Aussagen über die Haupteffekte auch für alle Gruppen gelten. Wenn bspw. der Haupteffekt des Wohnorts nur für Personen mit College-Abschluss gilt, aber nicht für Personen ohne Highschool-Abschluss (was durch eine signifikante Interaktion deutlich wird), dann ist die Interpretation des Haupteffekts des Wohnorts schwierig. Für interessierte Lesende wird in dem folgenden Kasten eine Beschreibung der unterschiedlichen Kombinationen an Signifikanzen gegeben.

<details><summary><b>Interpretation der Haupteffekte bei signifikanter Interaktion </b></summary>

Die Art der Interaktion wird in der Literatur in drei Bereiche aufgeteilt. Dabei wird zwischen *ordinalen*, *disordinalen* und *semidisordinalen* Interaktion unterschieden. Je nach Art ist die Interpretation der Haupteffekte zulässig, schwierig oder nicht zulässig.

Beginnen wir in unserer Betrachtung mit einem **ordinalen** Interaktionseffekt. Dabei vereinfachen wir das Beispiel für die zweifaktorielle ANOVA auf Faktoren mit jeweils nur zwei Faktorstufen - es gibt also Faktor A mit den Stufen A1 und A2 und Faktor B mit den Stufen B1 und B2. Die beiden hier dargestellten Grafiken stellen die Mittelwerte der 4 Kombinationen aus zwei verschiedenen Perspektiven da - einmal mit A auf der x-Achse und einmal mit B auf der x-Achse.

```{r, echo = FALSE, purl = FALSE}
# Dummy
means <- data.frame(
  A = c("A1", "A1", "A2", "A2"),
  B = c("B1", "B2", "B1", "B2"),
  mean_y = c(10, 18, 15, 20)
)

library(ggplot2)
library(patchwork)

# Plot mit A auf der x-Achse
p1 <- ggplot(means, aes(x=A, y=mean_y, group=B, color=B, shape=A)) +
  geom_point(size=3) +
  geom_line(aes(group=B), color="black", size=1) +  # Linien immer schwarz
  labs(y="Mittelwert", x="A") +
  theme_minimal()

# Plot mit B auf der x-Achse
p2 <- ggplot(means, aes(x=B, y=mean_y, group=A, color=B, shape=A)) +
  geom_point(size=3) +
  geom_line(aes(group=A), color="black", size=1) +  # Linien immer schwarz
  labs(y="Mittelwert", x="B") +
  theme_minimal()

# Beide Plots nebeneinander mit gemeinsamer Überschrift
(p1 + p2) + 
  plot_annotation(title="Ordinale Interaktion")
``` 

Die Farben zeigen uns stets den Faktor B an, die Formen den Faktor A. Die Linien verbinden immer die zusammengehörigen Faktorstufen auf dem Faktor, der nicht auf der x-Achse dargestellt ist. Ordinale Interaktion bedeutet nun, dass die bedingten Mittelwertsdifferenzen zwischen den Faktorstufen A (in diesem Fall A1 und A2) auf allen Stufen des Faktors B (B1 und B2) die gleichen Vorzeichen haben. Außerdem muss dasselbe für die bedingten Mittelwertsdifferenzen zwischen den Faktorstufen B (in diesem Fall B1 und B2) auf allen Stufen des Faktors A (A1 und A2) gelten. 

In unserem Beispiel sind diese Ansprüche erfüllt. In der linken Grafik können wir sehen, dass die Differenz zwischen den Stufen A2 und A1 auf beiden Stufen von B positiv ist (A2 > A1). In der rechten Grafik ist die Differenz zwischen den Stufen B2 und B1 auf beiden Stufen von A ebenfalls positiv (B2 > B1). 

Beim Vorliegen von ordinalen Effekten ist die Interpretation der Haupteffekte auch möglich, wenn die Interaktion signifikant ist.

Als zweites nehmen wir uns das Gegenteil - die disordinale Interaktion - vor. Auch hier zunächst eine grafische Darstellung des Falls mit der exakt selben Gestaltung wie eben.

```{r, echo = FALSE, purl = FALSE}
# Dummy
means <- data.frame(
  A = c("A1", "A1", "A2", "A2"),
  B = c("B1", "B2", "B1", "B2"),
  mean_y = c(10, 18, 20, 17)
)

# Plot mit A auf der x-Achse
p1 <- ggplot(means, aes(x=A, y=mean_y, group=B, color=B, shape=A)) +
  geom_point(size=3) +
  geom_line(aes(group=B), color="black", size=1) +  # Linien immer schwarz
  labs(y="Mittelwert", x="A") +
  theme_minimal()

# Plot mit B auf der x-Achse
p2 <- ggplot(means, aes(x=B, y=mean_y, group=A, color=B, shape=A)) +
  geom_point(size=3) +
  geom_line(aes(group=A), color="black", size=1) +  # Linien immer schwarz
  labs(y="Mittelwert", x="B") +
  theme_minimal()

# Beide Plots nebeneinander mit gemeinsamer Überschrift
(p1 + p2) + 
  plot_annotation(title="Disordinale Interaktion")
```

Bei einem disordinalen Interaktionseffekt ändert sich das Vorzeichen der bedingten Mittelwertsdifferenzen zwischen den Faktorstufen A (in diesem Fall A1 und A2) auf den Stufen des Faktors B (in diesem Fall B1 und B2). Weiterhin ändert sich das Vorzeichen der bedingten Mittelwertsdifferenzen zwischen den Faktorstufen B (in diesem Fall B1 und B2) auf den Stufen des Faktors A (in diesem Fall A1 und A2).
In unserem Beispiel ist das der Fall, da die Differenz zwischen den Stufen A2 und A1 auf der Stufe B1 positiv ist (A2 > A1), aber auf der Stufe B2 negativ (A2 < A1). Das gleiche gilt für die Differenz zwischen den Stufen B2 und B1 auf den Stufen von A. Auf der Stufe A1 ist die Differenz positiv (B2 > B1), auf der Stufe A2 negativ (B2 < B1).

Bei Vorliegen disordinaler Interaktionseffekte ist die Interpretation der Haupteffekte nicht zulässig - zumindest sollte nicht gesagt werden, dass eine Stufe des einen Faktors grundsätzlich besser ist, da dies ja von der Ausprägung auf dem anderen Faktor abhängt.

Der letzte Fall ist die **semidisordinale Interaktion**. Auch hier zunächst eine grafische Darstellung des Falls mit der exakt selben Gestaltung wie eben.

```{r, echo = FALSE, purl = FALSE}
# Dummy
means <- data.frame(
  A = c("A1", "A1", "A2", "A2"),
  B = c("B1", "B2", "B1", "B2"),
  mean_y = c(10, 18, 15, 16)
)

# Plot mit A auf der x-Achse
p1 <- ggplot(means, aes(x=A, y=mean_y, group=B, color=B, shape=A)) +
  geom_point(size=3) +
  geom_line(aes(group=B), color="black", size=1) +  # Linien immer schwarz
  labs(y="Mittelwert", x="A") +
  theme_minimal()

# Plot mit B auf der x-Achse
p2 <- ggplot(means, aes(x=B, y=mean_y, group=A, color=B, shape=A)) +
  geom_point(size=3) +
  geom_line(aes(group=A), color="black", size=1) +  # Linien immer schwarz
  labs(y="Mittelwert", x="B") +
  theme_minimal()

# Beide Plots nebeneinander mit gemeinsamer Überschrift
(p1 + p2) + 
  plot_annotation(title="Semidisordinale Interaktion")
```

Der semidisordinale Interaktionseffekt ist eine Mischung aus den beiden vorherigen Fällen. Die bedingten Mittelwertsdifferenzen zwischen den Faktorstufen A (in diesem Fall A1 und A2) auf den Stufen des Faktors B (in diesem Fall B1 und B2) haben die gleichen Vorzeichen und die bedingten Mittelwertsdifferenzen zwischen den Faktorstufen B (in diesem Fall B1 und B2) auf den Stufen des Faktors A (in diesem Fall A1 und A2) haben unterschiedliche Vorzeichen - oder natürlich umgekehrt.

Auf den Abbildungen ist das der Fall - die Differenz zwischen den Stufen A2 und A1 auf der Stufe B1 ist positiv (A2 > A1), aber auf der Stufe B2 negativ (A2 < A1). Die Differenz zwischen den Stufen B2 und B1 auf der Stufe A1 ist positiv (B2 > B1), und auf der Stufe A2 ebenfalls positiv (B2 > B1).

Beim Vorliegen der semidisordinalen Interaktionseffekte ist die Interpretation der Haupteffekte besonders für den Faktor schwierig, bei dem die Vorzeichen wechseln, da hier wie bei der disordinalen Interaktion keine generale Aussage getroffen werden kann. Bei der Interpretation des Faktors, bei dem die Vorzeichen gleich bleiben, kann hingegen eher eine Aussage getroffen werden, da hier die Haupteffekte auch für alle Stufen des anderen Faktors gelten. 

Welche unterschiedlichen Kombinationen an Signifikanzen (der Haupt- und Interaktionseffekte) es gibt und was diese schematisch bedeuten, kann auch in [Eid et al. (2017](https://hds.hebis.de/ubffm/Record/HEB366849158), p. 436, Abbildung 13.6) nachgelesen werden.

</details>


## Post-Hoc-Analysen

### Tukey-Test

Wie auch schon im [letzten Tutorial](/lehre/statistik-ii/anova-i) können bei der zweifaktoriellen ANOVA mit der *Tukeys Honest Significant Difference* alle möglichen Gruppenkombinationen verglichen werden. Aufgrund der hohen Anzahl von insgesamt neun spezifischen Paarvergleichen ist es hier besonders wichtig, die Tukey-Vorgehensweise statt einer einfachen Bonferroni-Korrektur zu nutzen, um nicht zu viel Power zu verlieren. Allerdings stellt sich bei einem so großen Design die Frage, ob der stupide Vergleich aller Gruppen miteinander überhaupt sinnvoll ist. Denn dieser Ansatz setzt voraus, dass die Effekte in allen spezifischen Gruppen tatsächlich unterschiedlich sind. Wahrscheinlicher ist es jedoch, dass man gezielt bestimmte Muster oder Hypothesen verfolgt und daher nur ausgewählte Gruppenvergleiche durchführt. Trotzdem führen wir hier einmal die Tukey-Analyse durch – einerseits, um für Ausnahmefälle gewappnet zu sein, und andererseits, um die Schreibweise der zweifaktoriellen ANOVA im Paket zu üben.


Zunächst müssen wir unsere Analyse in ein Objekt ablegen. 

```{r}
zweifakt <- aov_4(EC ~ urban + edu + urban : edu + (1|id), data = conspiracy)
```

Außerdem müssen wir wieder das Paket `emmeans` laden und die `emmeans`-Funktion verwenden, um die Post-Hoc-Analyse vorzubereiten. 

```{r}
library(emmeans)
emm_zweifakt <- emmeans(zweifakt, ~ urban + edu + urban : edu)
```

Die `pairs()`-Funktion erlaubt uns nun die Gegenüberstellung aller Gruppen. Als zusätzliches Argument, neben dem Objekt, brauchen wir nur die Aussage, dass die Vergleiche mit der Tukey-Methode korrigiert werden sollen.

```{r}
tukey <- pairs(emm_zweifakt, adjust = "tukey")
tukey
```

Leider ist das Ergebnis etwas unübersichtlich, weil sich in diesem Fall 36 Vergleiche ergeben. Die erste Spalte zeigt jeweils, welche Gruppen verglichen wurden. Anschließend folgen Spalten für die Mittelwertsdifferenz, den Standardfehler, die Freiheitsgrade, die bestimmte Teststatistik und den korrigierten *p*-Wert. Beispielsweise könnte man erkennen, dass es signifikante Unterschiede zwischen Der Gruppe `suburban / not highschool` und der Gruppe `suburban / college` gibt, da der *p*-Wert kleiner als 0.05 ist.

Stattdessen können wir uns das Objekt auch sehr einfach plotten lassen:

```{r, fig = TRUE}
plot(tukey)
```

Hier wäre es wichtig zu betrachten, welches Konfidenzintervall für die Mittelwertsdifferenz nicht die 0 enhält, um signifikante Unterschiede zu erkennen.


### Spezifische Kontraste

Wie bereits erwähnt, ist es in Situationen mit vielen Gruppen eher unüblich, alle möglichen Vergleiche durchzuführen. Zum einen ist es aus theoretischer Perspektive selten plausibel, dass sich tatsächlich alle spezifischen Kombinationen voneinander unterscheiden. Zum anderen ist es aus methodischer Sicht auch wenig effizient, da die notwendige Korrektur des $\alpha-$Fehlerniveaus die Power stark reduzieren würde. An dieser Stelle bieten sich daher *geplante Kontraste* an: Mit ihnen können a-priori definierte, theoretisch relevante Vergleiche gezielt durchgeführt werden. So wird die Anzahl der Tests auf das Wesentliche beschränkt und die Korrektur weniger restriktiv, was insgesamt zu einer effizienteren Analyse führt.



Gehen wir einmal davon aus, dass Bildung auf College-Niveau beginnt, eigenständiges Denken und das kritische Abwägen von Informationsquellen stärker zu fördern – anders als Bildung auf niedrigeren Niveaus. Eine plausible Annahme wäre, dass insbesondere im College-Umfeld Kompetenzen wie Quellenbewertung, kritische Reflexion und analytisches Denken intensiv vermittelt werden. Daher könnte eine spezifische Hypothese in unserer Untersuchung lauten, dass sich Personen mit einem College-Abschluss hinsichtlich ihres Glaubens an Verschwörungstheorien über ein angebliches „extraterrestrisches Cover-up“ von allen Personen mit einem niedrigeren Bildungsniveau unterscheiden. Diese Fragestellung müssen wir nun in einen passenden Kontrast überführen.

Um Kontraste definieren zu können, müssen wir zunächst in Erfahrung bringen, in welcher Reihenfolge die Gruppenkombinationen intern repräsentiert werden. Diese Reihenfolge können wir durch betrachten des Objektes `emm_zweifakt` herausfinden:

```{r}
emm_zweifakt
```

Mithilfe eines 9 Elemente langen Vektors, in dem die Kontraskoeffizienten stehen, können Kontraste festgelegt werden. In unserer Fragestellung sollen global die Mittelwerte der drei Gruppen, die `college` in ihrer Kombination haben, mit den 6 Gruppen, die `not highschool` oder `highschool` in ihrer Kombination haben, verglichen werden. Das bedeutet, dass die Koeffizienten für die Gruppen mit College-Abschluss positiv und die anderen negativ sein sollten. Eine weitere Voraussetzung für Kontrastkoeffizienten, die wir bereits kennen, lautet, dass sich die Koeffizienten zu 0 addieren müssen. Das bedeutet, dass die Summe der Koeffizienten für die Gruppen mit College-Abschluss bspw. 3 und die Summe der Koeffizienten für die anderen Gruppen -3 betragen muss. Daraus würde sich ergeben, dass alle Gruppen mit College-Abschluss den Koeffizienten `1` zugewiesen bekommen, während die anderen Gruppen den Koeffizienten `-0.5` zugewiesen bekommen.


```{r}
cont1 <- c(-0.5, -0.5, -0.5, -0.5, -0.5, -0.5, 1, 1, 1)
sum(cont1) == 0 # Check ob die Koeffizienten sich zu 0 addieren
```

Die Nullhypothese, die durch diesen Vektor geprüft wird, lässt sich mithilfe der Reihenfolge der Gruppen leicht zusammenstellen. Wenn $j$ die drei Stufen von `urban` indiziert (1 = rural, 2 = suburban, 3 = urban) und $k$ die drei Stufen von `edu` (1 = not highschool, 2 = highschool, 3 = college), ist die durch `cont1` festgelegte Nullhypothese:

$H_0: -0.5 \cdot \mu_{11} - -0.5 \cdot \mu_{21} + -0.5 \cdot \mu_{31} + -0.5 \cdot \mu_{12} + -0.5 \cdot \mu_{22} + -0.5 \cdot \mu_{32} + 1 \cdot \mu_{13} + 1 \cdot \mu_{23} + 1 \cdot \mu_{33} = 0$

Mit dem `contrast`-Befehl kann der festgelegte Kontrast geprüft werden, indem wir das Mittelwertsobjekt `emm` übergeben und anschließend die Gruppenzugehörigkeit via Kontrast als Liste `list(cont1)` übergeben:

```{r}
contrast(emm_zweifakt, list(cont1))
```

Der Kontrast zeigt uns hier ein signifikantes Ergebnis, was bedeutet, dass Personen, die auf dem College waren, sich signifikant von Personen unterscheiden, die nicht auf dem College waren.



Eine weitere interessante Forschungsfrage wäre hier, ob der Abstand zwischen den nicht-College Gruppen und der College Gruppe für die beiden Subgruppen `rural` und `urban` gleich groß ist. Damit kann getestet werden, ob der Effekt der höheren Bildung vielleicht vom Wohnort abhängt (diese Testung würde bei einem signifikanten Interaktionseffekt mehr Sinn machen, wird hier aber trotzdem durchgeführt). Stellen wir uns das Prinzip als Gleichung vor, um die Kontrastkoeffizienten zu vergeben:


$\mu_{11} + \mu_{12}}{2} - \mu_{13} = \frac{\mu_{31} + \mu_{32}}{2} - \mu_{33}$

Für die einfache Vergabe von Kontrastkoeffizienten sollte die Gleichung umgestellt werden:

$\mu_{11} + \cdot \mu_{12}}{2} - \mu_{13} - \frac{\mu_{31} + \mu_{32}}{2} 2 \mu_{33} = 0$

Daraus ergibt sich dann:

$H_0: 0.5 \cdot \mu_{11} + 0.5 \cdot \mu_{12} - 1 \cdot \mu_{13} - 0.5 \cdot \mu_{31} - 0.5 \cdot \mu_{32} +  1 \cdot \mu_{33} = 0$

Zugeordnet zur Reihenfolge der Gruppen also folgendes Muster:

```{r}
cont2 <- c(0.5, 0, -0.5, 0.5, 0, -0.5, -1, 0, 1)
```


Weil sowohl `cont1` als auch `cont2` durchgeführt werden, muss für das multiple Testen der beiden korrigiert werden. Das kann dadurch erreicht werden, dass im `contrast`-Befehl alle Kontraste gleichzeitig eingeschlossen werden und mit `adjust = 'bonferroni'` z.B. die Bonferroni-Korrektur ausgewählt wird:

```{r}
contrast(emm_zweifakt, list(cont1, cont2), adjust = 'bonferroni')
```

Der erste Kontrast ist weiterhin signifikant, der zweite jedoch schon (p = 0.0414 < 0.05). Dieses Ergebnis ist aber auch nicht überraschend, da kein Interaktionseffekt in den Daten vorlag. Die Anzahl der geplanten Kontraste ist theoretisch endlos - der Fokus liegt hier auf den Erwartungen, die aus der Theorie abgeleitet werden. 


Sollen Hypothesen möglichst effektiv getestet werden, sollten Kontraste orthogonal, das heißt voneinander unabhängig sein. Zwei orthogonale Kontraste erkennt man daran, dass die Summe aller gewichteten Kontrastprodukte gleich 0 ist. Bei geplanten Kontrasten ist dies jedoch selten der Fall, da die Fragestellungen bzw. Hypothesen, die man aus der Literatur ableitet, selten komplett voneinander unabhängig sind. 


### Reduzierte ANOVA

Nach einer signifikanten mehrfaktoriellen ANOVA können als Post-hoc Analyse auch weitere ANOVAs durchgeführt werden! Bspw. könnte es bei nicht signifikantem Interaktionseffekt von Interesse sein, in den Haupteffekten noch spezifischere Untersuchungen durchzuführen. Oder man reduziert bei signifikantem Interaktionseffekt die Anzahl der Ausprägungen auf beiden Faktoren, um spezifischere Aspekte des Interaktionseffektes zu untersuchen. Es zeigt sich: Die Möglichkeiten für Post-hoc-Analysen sind vielfältig und hängen stark von der Forschungsfrage ab.

***

## Appendix A {#AppendixA .anchorhead}

<details><summary><b>Quadratsummen-Typ</b></summary>

Wie beschrieben, können bei mehrfaktoriellen ANOVAs die Quadratsummen auf unterschiedliche Arten berechnet werden. 

### Typ I

Typ I berücksichtigt in der Berechnung der Quadratsummen nur die vorherigen unabhängigen Variablen. Dies entspricht konzeptuell der sequentiellen Aufnahme von Prädiktoren in der Regression. In `afex` ist diese Berechnung gar nicht möglich, da man das Argument `type` nicht damit ansprechen kann. 

```{r, error = TRUE, purl = FALSE}
aov_4(EC ~ urban + edu + urban : edu + (1|id), data = conspiracy, type = I)
```

In der Fehlermeldung steht direkt drin, dass der Typ nicht unterstützt wird. Das deutet schonmal daraufhin, dass diese Einstellung nicht sinnvoll wäre. Um den Effekt zu betrachten, brauchen wir also ein anderes Paket - nutzen wir bspw. das Paket `ez`. Das müssen wir zunächst installieren und dann aktivieren.

```{r, purl = FALSE, eval = FALSE}
install.packages("ez")
library(ez)
```

```{r, purl = FALSE, echo = FALSE}
library(ez)
```

In dem Paket wird die Funktion `ezANOVA()` verwendet, um eine ANOVA durchzuführen. Diese Funktion hat ein Argument `type`, welches die Quadratsummen-Typen angibt. Wir können also Typ I anfordern, indem wir `type = 1` setzen. Weitere benötigte Argument sind der Datensatz, die abhängige Variable `dv`, die ID-Variable `wid` und die unabhängigen Variablen `between`. Diese müssen als Vektor angegeben werden, da wir hier eine mehrfaktorielle ANOVA durchführen wollen. 

```{r, purl = FALSE}
# QS-Typ 1, Reihenfolge 1
ezANOVA(conspiracy, dv = EC, wid = id, between = c(urban, edu), type = 1)

# QS-Typ 1, Reihenfolge 2
ezANOVA(conspiracy, dv = EC, wid = id, between = c(edu, urban), type = 1)
```

Die Reihenfolge der Prädiktoren spielt dabei eine Rolle, da die Quadratsummen in der Reihenfolge der Prädiktoren berechnet werden. Das heißt, dass die Quadratsumme für den ersten Prädiktor nur die Varianz erklärt, die nicht durch den zweiten Prädiktor erklärt wird. Daher ist es wichtig, in welcher Reihenfolge die Prädiktoren angegeben werden. Wir sehen deutlich, dass sich der $F$-Wert ändert, je nach dem in welcher Reihenfolge die Prädiktoren in die Gleichung genommen werden. Demnach kann es sein, dass die Reihenfolge die Signifikanzentscheidung beeinflusst.

### Typ II und Typ 3 in `ezANOVA()`

Wie bereits beschrieben berücksichtigt Typ II in der Berechnung der Quadratsummen alle anderen unabhängigen Variablen. In der Berechnung der einzelnen Quadratsummen wird allerdings angenommen, dass alle Interaktionen, an denen dieser Term beteiligt ist, 0 sind. Typ II ist in `ezANOVA()` voreingestellt - im Gegensatz zu der Einstellung in `aov_4()`.

```{r, purl = FALSE}
# QS-Typ 2
ezANOVA(conspiracy, dv = EC, wid = id, between = c(urban, edu))
```

Typ III lässt sich auch durch eine einfache Einstellung in `ezANOVA()` anfordern. Dabei wird nicht angenommen, dass die Interaktionen 0 sind. Typ III ist z.B. auch in SPSS voreingestellt.

```{r, purl = FALSE}
# QS-Typ 3
ezANOVA(conspiracy, dv = EC, wid = id, between = c(urban, edu), type = 3)
```

</details>


## Appendix B {#AppendixB .anchorhead}

<details><summary><b>Voraussetzungen-Typ</b></summary>

Die Voraussetzungsprüfung für between-Subject Fragestellungen ist aktuell noch nicht optimiert in `afex`. Bspw. ist es hier auch nötig, mit dem  *Levene Test* die Homoskedastizitätsannahme (in diesem Fall: die Varianz ist in allen 9 Gruppen identisch) zu prüfen. 

Im auch in Anhang A genutzten Paket `ez` ist in der Funktion `ezANOVA()` die Prüfung der Homoskedastizität bereits integriert. Diese wird automatisch durchgeführt, wenn die ANOVA mit `ezANOVA()` durchgeführt wird. Auch eine Korrektur für eine signifikante Verletzung, wie sie bei dem hier verwendeten Datenbeispiel auftreten würde, ist eingebaut. Dabei handelt es sich um die HC3-Korrektur von MacKinnon & White (1985). Diese kann mit dem Argument `white.adjust = TRUE` aktiviert werden. 

```{r, purl = FALSE}
ezANOVA(conspiracy, dv = EC, wid = id, between = c(urban, edu), detailed = TRUE, white.adjust = TRUE)
```
</details>

***

## Literatur
[Eid, M., Gollwitzer, M., & Schmitt, M. (2017).](https://hds.hebis.de/ubffm/Record/HEB366849158) *Statistik und Forschungsmethoden* (5. Auflage, 1. Auflage: 2010). Weinheim: Beltz. 


* <small> *Blau hinterlegte Autorenangaben führen Sie direkt zur universitätsinternen Ressource.*
